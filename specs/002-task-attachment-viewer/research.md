# Research: Todoist Task Attachment Viewer (Mobile)

## Decision 1: Lightbox Implementation Strategy

**Decision**: Pure vanilla JavaScript overlay — no external library dependencies
**Rationale**: The entire ActionOS frontend is inline JS/CSS generated by Python
string literals in `todoist_views.py`. There is no npm build step, no CDN
imports, and no module system. Adding a library (e.g., Fancybox, PhotoSwipe)
would require a script tag pointing to an external CDN, introducing a network
dependency and breaking the self-contained deployment model. A ~40-line vanilla
implementation covers all requirements. **Alternatives Considered**:

- PhotoSwipe v5: Excellent, but requires ES module import or CDN script tag —
  incompatible with current build model
- CSS-only lightbox (checkbox hack): No swipe support, poor accessibility
- `<dialog>` element: Good native support, but requires careful polyfilling for
  older Safari; vanilla overlay achieves the same result with less complexity

---

## Decision 2: Swipe Gesture Detection

**Decision**: Native touch events (`touchstart` / `touchend` delta > 50px
threshold) on the lightbox overlay **Rationale**: All interaction code in
ActionOS uses native browser events (onclick, onchange). Introducing a gesture
library (Hammer.js, etc.) adds build complexity. A 15-line touch handler covers
swipe-left/right with negligible maintenance cost. **Alternatives Considered**:

- Pointer Events API: More unified but adds code complexity for no benefit in
  this single-surface app
- No swipe (button-only navigation): Acceptable fallback but inferior mobile UX

---

## Decision 3: Full-Resolution vs. Thumbnail in Lightbox

**Decision**: Use `file_url` (full-resolution) in lightbox, `image` (thumbnail)
for the grid preview **Rationale**: Todoist's `file_attachment` object returns
both `image` (thumbnail) and `file_url` (original). The existing code already
uses `(img||fu)` for the thumbnail `<img src>`. The lightbox should display the
original for readability. **Alternatives Considered**:

- Use thumbnail in lightbox: Simpler but images may appear pixelated on high-DPI
  screens
- Always use `file_url` for thumbnails too: Slower initial load, unnecessary
  bandwidth

---

## Decision 4: Keyboard and Accessibility

**Decision**: ESC key closes lightbox; arrow keys navigate; `aria-modal` and
`role="dialog"` on overlay **Rationale**: Desktop users (and some mobile
keyboards) benefit from keyboard navigation. Adding basic `keydown` listener for
ESC/arrows is 5 lines of code. **Alternatives Considered**:

- No keyboard support: Excludes desktop and power users

---

## Decision 5: Scope — Images Only Get Lightbox; Non-Image Files Keep `target="_blank"`

**Decision**: Only image attachments use the lightbox. Non-image files (PDFs,
docs) keep `target="_blank"` link behavior, which triggers the native browser
download/preview flow on mobile. **Rationale**: Non-image files have no sensible
inline rendering approach without a PDF viewer or file preview library. The
native browser flow is correct for downloads. Consistent with spec FR-005.
**Alternatives Considered**:

- In-app PDF viewer: Major scope expansion (embedded iframe + CORS
  considerations)
- Block all external navigation: Would break file downloads for non-images

---

## Summary: Only `todoist_views.py` Changes Required

All changes are contained within `apps/ActionOS/src/todoist_views.py`:

1. Add lightbox CSS (attached to `<style>` section)
2. Add lightbox HTML element (in viewer pane HTML)
3. Modify `loadTaskAttachments` JS: replace `target="_blank"` image links with
   `onclick="openLightbox(urls, i)"`
4. Add `openLightbox`, `closeLightbox`, `lightboxNav` JS functions
5. Add touch swipe handler on the lightbox overlay

No new files. No backend changes. No dependency additions.
