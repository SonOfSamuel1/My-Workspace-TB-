name: Export Credentials (Manual Trigger Only)

on:
  workflow_dispatch:
    inputs:
      export_type:
        description: 'What to export'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - gmail_only
          - claude_only

jobs:
  export-credentials:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Export Gmail Credentials
        if: ${{ github.event.inputs.export_type == 'all' || github.event.inputs.export_type == 'gmail_only' }}
        run: |
          echo "========================================="
          echo "Gmail OAuth Credentials (base64 decoded)"
          echo "========================================="
          echo ""
          echo '${{ secrets.GMAIL_OAUTH_CREDENTIALS }}' | base64 -d
          echo ""
          echo ""
          echo "========================================="
          echo "Gmail User Credentials (base64 decoded)"
          echo "========================================="
          echo ""
          echo '${{ secrets.GMAIL_CREDENTIALS }}' | base64 -d
          echo ""

      - name: Export Claude Token
        if: ${{ github.event.inputs.export_type == 'all' || github.event.inputs.export_type == 'claude_only' }}
        run: |
          echo "========================================="
          echo "Claude Code OAuth Token"
          echo "========================================="
          echo ""
          echo '${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}'
          echo ""

      - name: Export Twilio Credentials
        if: ${{ github.event.inputs.export_type == 'all' }}
        run: |
          echo "========================================="
          echo "Twilio Credentials"
          echo "========================================="
          echo ""
          echo "Account SID: ${{ secrets.TWILIO_ACCOUNT_SID }}"
          echo "Auth Token: ${{ secrets.TWILIO_AUTH_TOKEN }}"
          echo "From Number: ${{ secrets.TWILIO_FROM_NUMBER }}"
          echo ""

      - name: Instructions
        run: |
          echo ""
          echo "========================================="
          echo "How to Use These Credentials"
          echo "========================================="
          echo ""
          echo "1. Copy the JSON outputs above"
          echo ""
          echo "2. Save Gmail OAuth credentials to:"
          echo "   ~/.gmail-mcp/gcp-oauth.keys.json"
          echo ""
          echo "3. Save Gmail user credentials to:"
          echo "   ~/.gmail-mcp/credentials.json"
          echo ""
          echo "4. Export Claude token:"
          echo "   export CLAUDE_CODE_OAUTH_TOKEN='<token>'"
          echo ""
          echo "5. Run Lambda deployment:"
          echo "   cd lambda && ./deploy-auto.sh"
          echo ""
