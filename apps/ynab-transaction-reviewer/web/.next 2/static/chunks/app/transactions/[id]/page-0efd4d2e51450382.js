(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[114],{8853:function(e,t,a){Promise.resolve().then(a.bind(a,3989))},3989:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return q}});var r=a(7437),s=a(2265),n=a(1713),i=a(9827),c=a(1770);let o="2a373a3b-bc29-46f0-92ab-008f3b0221a9";async function l(e){let t=await fetch("/api/ynab/budgets/".concat(o,"/transactions/").concat(e));if(!t.ok)throw Error("Failed to fetch transaction");return(await t.json()).data.transaction}async function d(){let e=await fetch("/api/ynab/budgets/".concat(o,"/categories"));if(!e.ok)throw Error("Failed to fetch categories");return(await e.json()).data.category_groups}async function u(e,t){let a=await fetch("/api/ynab/budgets/".concat(o,"/transactions/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({transaction:t})});if(!a.ok){var r;throw Error((null===(r=(await a.json()).error)||void 0===r?void 0:r.detail)||"Failed to update transaction")}return(await a.json()).data.transaction}function m(){let e=(0,i.NL)();return(0,c.D)({mutationFn:e=>{let{transactionId:t,update:a}=e;return u(t,a)},onSuccess:(t,a)=>{e.setQueryData(["transaction",a.transactionId],t),e.invalidateQueries({queryKey:["transactions"]})}})}var f=a(2381),x=a(3448);let h=s.forwardRef((e,t)=>{let{className:a,type:s,...n}=e;return(0,r.jsx)("input",{type:s,className:(0,x.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...n})});h.displayName="Input";var p=a(370);let g=(0,a(535).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),b=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(p.f,{ref:t,className:(0,x.cn)(g(),a),...s})});b.displayName=p.f.displayName;var v=a(9820),y=a(9174),j=a(875),N=a(3247),w=a(401);function C(e){let{categories:t,value:a,onChange:n,disabled:i=!1}=e,[c,o]=s.useState(!1),[l,d]=s.useState(""),u=s.useRef(null),m=s.useMemo(()=>{for(let e of t){let t=e.categories.find(e=>e.id===a);if(t)return t}return null},[t,a]),h=s.useMemo(()=>{if(!l)return t;let e=l.toLowerCase();return t.map(t=>({...t,categories:t.categories.filter(a=>a.name.toLowerCase().includes(e)||t.name.toLowerCase().includes(e))})).filter(e=>e.categories.length>0)},[t,l]);return s.useEffect(()=>{function e(e){u.current&&!u.current.contains(e.target)&&o(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,r.jsxs)("div",{ref:u,className:"relative",onKeyDown:e=>{"Escape"===e.key&&o(!1)},children:[(0,r.jsxs)(f.z,{variant:"outline",role:"combobox","aria-expanded":c,disabled:i,className:"w-full justify-between",onClick:()=>o(!c),children:[m?m.name:"Select category...",(0,r.jsx)(j.Z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]}),c&&(0,r.jsxs)("div",{className:"absolute z-50 mt-1 w-full rounded-md border bg-popover shadow-lg",children:[(0,r.jsxs)("div",{className:"flex items-center border-b px-3",children:[(0,r.jsx)(N.Z,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,r.jsx)("input",{type:"text",placeholder:"Search categories...",value:l,onChange:e=>d(e.target.value),className:"flex h-10 w-full bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground",autoFocus:!0})]}),(0,r.jsx)("div",{className:"max-h-[300px] overflow-y-auto p-1",children:0===h.length?(0,r.jsx)("p",{className:"py-6 text-center text-sm text-muted-foreground",children:"No categories found."}):h.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground",children:e.name}),e.categories.filter(e=>!e.hidden).map(e=>(0,r.jsxs)("button",{onClick:()=>{n(e.id),o(!1),d("")},className:(0,x.cn)("flex w-full cursor-pointer items-center rounded-sm px-2 py-1.5 text-sm hover:bg-accent",e.id===a&&"bg-accent"),children:[(0,r.jsx)(w.Z,{className:(0,x.cn)("mr-2 h-4 w-4",e.id===a?"opacity-100":"opacity-0")}),e.name]},e.id))]},e.id))})]})]})}var k=a(9322),Z=a(1723),F=a(1671),S=a(44),E=a(2369),_=a(5252),R=a(1047),T=a(8736),z=a(2489),A=a(1817);function D(e){let{transaction:t,categories:a,onSave:n,onApprove:i,onCancel:c}=e,[o,l]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),[m,p]=(0,s.useState)(!1),[g,j]=(0,s.useState)(t.payee_name),[N,D]=(0,s.useState)(t.memo||""),[L,M]=(0,s.useState)(t.date),[O,q]=(0,s.useState)(t.category_id),[I,K]=(0,s.useState)(Math.abs((0,x.RR)(t.amount)).toFixed(2)),U=t.amount<0,Y=async()=>{l(!0),u(null),p(!1);try{let e=(0,x.v3)(parseFloat(I)),a={id:t.id,payee_name:g,memo:N||null,date:L,category_id:O,amount:U?-Math.abs(e):Math.abs(e)};await n(a),p(!0),setTimeout(()=>p(!1),2e3)}catch(e){u(e instanceof Error?e.message:"Failed to save transaction")}finally{l(!1)}},P=async()=>{if(i){l(!0),u(null);try{await i(),p(!0)}catch(e){u(e instanceof Error?e.message:"Failed to approve transaction")}finally{l(!1)}}};return(0,r.jsxs)(v.Zb,{className:"w-full max-w-2xl mx-auto",children:[(0,r.jsxs)(v.Ol,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(v.ll,{className:"text-xl",children:"Edit Transaction"}),t.category_id?t.approved?(0,r.jsxs)(y.C,{variant:"success",className:"flex items-center gap-1",children:[(0,r.jsx)(F.Z,{className:"h-3 w-3"}),"Approved"]}):(0,r.jsxs)(y.C,{variant:"info",className:"flex items-center gap-1",children:[(0,r.jsx)(Z.Z,{className:"h-3 w-3"}),"Pending Approval"]}):(0,r.jsxs)(y.C,{variant:"warning",className:"flex items-center gap-1",children:[(0,r.jsx)(k.Z,{className:"h-3 w-3"}),"Uncategorized"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,r.jsx)(S.Z,{className:"h-4 w-4"}),t.account_name]})]}),(0,r.jsxs)(v.aY,{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,r.jsxs)("span",{className:"text-4xl font-bold ".concat(U?"text-red-600":"text-green-600"),children:[U?"-":"+",(0,x.xG)(Math.abs(t.amount))]})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(b,{htmlFor:"payee",className:"flex items-center gap-2",children:[(0,r.jsx)(E.Z,{className:"h-4 w-4"}),"Payee"]}),(0,r.jsx)(h,{id:"payee",value:g,onChange:e=>j(e.target.value),placeholder:"Enter payee name"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(b,{className:"flex items-center gap-2",children:[(0,r.jsx)(_.Z,{className:"h-4 w-4"}),"Category"]}),(0,r.jsx)(C,{categories:a,value:O,onChange:q})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(b,{htmlFor:"date",className:"flex items-center gap-2",children:[(0,r.jsx)(R.Z,{className:"h-4 w-4"}),"Date"]}),(0,r.jsx)(h,{id:"date",type:"date",value:L,onChange:e=>M(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(b,{htmlFor:"memo",className:"flex items-center gap-2",children:[(0,r.jsx)(T.Z,{className:"h-4 w-4"}),"Memo"]}),(0,r.jsx)(h,{id:"memo",value:N,onChange:e=>D(e.target.value),placeholder:"Add a memo (optional)"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(b,{htmlFor:"amount",className:"flex items-center gap-2",children:[(0,r.jsx)(_.Z,{className:"h-4 w-4"}),"Amount"]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"$"}),(0,r.jsx)(h,{id:"amount",type:"number",step:"0.01",min:"0",value:I,onChange:e=>K(e.target.value),className:"pl-7"})]})]}),d&&(0,r.jsx)("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:d}),m&&(0,r.jsxs)("div",{className:"rounded-md bg-green-100 p-3 text-sm text-green-800 flex items-center gap-2",children:[(0,r.jsx)(F.Z,{className:"h-4 w-4"}),"Transaction saved successfully!"]})]}),(0,r.jsxs)(v.eW,{className:"flex justify-between gap-2",children:[(0,r.jsx)("div",{className:"flex gap-2",children:c&&(0,r.jsxs)(f.z,{variant:"outline",onClick:c,disabled:o,children:[(0,r.jsx)(z.Z,{className:"mr-2 h-4 w-4"}),"Cancel"]})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[!t.approved&&i&&(0,r.jsxs)(f.z,{variant:"success",onClick:P,disabled:o,children:[o?(0,r.jsx)(A.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Approve"]}),(0,r.jsxs)(f.z,{onClick:Y,disabled:o,children:[o?(0,r.jsx)(A.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]})]})}var L=a(2660),M=a(6362),O=a(7648);function q(e){let{params:t}=e,{id:a}=(0,s.use)(t),{data:i,isLoading:c,error:o}=(0,n.a)({queryKey:["transaction",a],queryFn:()=>l(a),enabled:!!a}),{data:u,isLoading:x}=(0,n.a)({queryKey:["categories"],queryFn:d,staleTime:3e5}),h=m(),p=function(){let e=m();return{...e,mutateAsync:t=>e.mutateAsync({transactionId:t,update:{approved:!0}})}}(),g=async e=>{await h.mutateAsync({transactionId:a,update:e})},b=async()=>{await p.mutateAsync(a)};return c||x?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)(A.Z,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Loading transaction..."})]})}):o||!i?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center p-4",children:(0,r.jsx)(v.Zb,{className:"w-full max-w-md",children:(0,r.jsxs)(v.aY,{className:"flex flex-col items-center gap-4 pt-6",children:[(0,r.jsx)(k.Z,{className:"h-12 w-12 text-destructive"}),(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Transaction Not Found"}),(0,r.jsx)("p",{className:"text-center text-muted-foreground",children:o instanceof Error?o.message:"The transaction you are looking for could not be found."}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)(f.z,{variant:"outline",asChild:!0,children:(0,r.jsxs)(O.default,{href:"/",children:[(0,r.jsx)(L.Z,{className:"mr-2 h-4 w-4"}),"Go Home"]})})})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-muted/30 py-8 px-4",children:(0,r.jsxs)("div",{className:"mx-auto max-w-2xl",children:[(0,r.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsx)(f.z,{variant:"ghost",asChild:!0,children:(0,r.jsxs)(O.default,{href:"/",children:[(0,r.jsx)(L.Z,{className:"mr-2 h-4 w-4"}),"Back"]})}),(0,r.jsx)(f.z,{variant:"outline",asChild:!0,children:(0,r.jsxs)("a",{href:"https://app.ynab.com/".concat("2a373a3b-bc29-46f0-92ab-008f3b0221a9","/accounts/").concat(i.account_id),target:"_blank",rel:"noopener noreferrer",children:[(0,r.jsx)(M.Z,{className:"mr-2 h-4 w-4"}),"Open in YNAB"]})})]}),(0,r.jsx)(D,{transaction:i,categories:u||[],onSave:g,onApprove:b})]})})}},9174:function(e,t,a){"use strict";a.d(t,{C:function(){return c}});var r=a(7437);a(2265);var s=a(535),n=a(3448);let i=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",warning:"border-transparent bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200",info:"border-transparent bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)(i({variant:a}),t),...s})}},2381:function(e,t,a){"use strict";a.d(t,{z:function(){return l}});var r=a(7437),s=a(2265),n=a(5293),i=a(535),c=a(3448);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-green-600 text-white hover:bg-green-700",warning:"bg-amber-500 text-white hover:bg-amber-600"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:a,variant:s,size:i,asChild:l=!1,...d}=e,u=l?n.g7:"button";return(0,r.jsx)(u,{className:(0,c.cn)(o({variant:s,size:i,className:a})),ref:t,...d})});l.displayName="Button"},9820:function(e,t,a){"use strict";a.d(t,{Ol:function(){return c},Zb:function(){return i},aY:function(){return l},eW:function(){return d},ll:function(){return o}});var r=a(7437),s=a(2265),n=a(3448);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});i.displayName="Card";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});c.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});o.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...s})});l.displayName="CardContent";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})});d.displayName="CardFooter"},3448:function(e,t,a){"use strict";a.d(t,{Km:function(){return l},RR:function(){return i},cn:function(){return n},v3:function(){return c},xG:function(){return o}});var r=a(1994),s=a(3335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}function i(e){return e/1e3}function c(e){return Math.round(1e3*e)}function o(e){let t=i(e);return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)}function l(e){let t=new Date(e),a=Math.floor((new Date().getTime()-t.getTime())/864e5);return 0===a?"Today":1===a?"Yesterday":a<7?"".concat(a," days ago"):function(e){let t=new Date(e);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(t)}(e)}}},function(e){e.O(0,[763,374,131,971,117,744],function(){return e(e.s=8853)}),_N_E=e.O()}]);